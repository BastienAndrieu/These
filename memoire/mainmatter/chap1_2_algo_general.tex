stique %\chapter[Algorithme de propagation d'interfaces régulières \piecewise]{Algorithme général pour la propagation d'interfaces régulières \piecewise}
\chapter[Algorithme général pour la propagation d'interfaces $\contgeom{1}$ \piecewise]{Mise au point d'un algorithme général pour la propagation d'interfaces régulières \piecewise}
\label{chap:algo_general}

\newcommand{\Right}[1]{\lo{#1}}%{#1_R}
\newcommand{\Left}[1]{\hi{#1}}%{#1_L}

%Objectif : proposer un algorithme de construction de l'EdB sous la forme d'un nouveau modèle \brep\ à partir du modèle \brep\ de l'interface courante. 
%Pour cela, on tire d'abord des observations sur lesquelles on se basera pour construire dans un premier temps une pseudo-EdS, que l'on traitera dans un second temps afin d'obtenir l'EdB. 
%Dans ce chapitre, on explicitera une partie des algorithmes utilisés mais les détails de la mise en \oe uvre numérique feront l'objet du chapitre suivant.
\input{figures/code/EoB_BRep/EoB_BRep.tex}

Dans ce deuxième chapitre on propose un algorithme basé sur le principe de Huygens avec condition d'entropie pour simuler la propagation d'une interface décrite dans le formalisme de la représentation par les frontières. 
L'objectif est donc de construire un nouveau modèle \brep\ décrivant l'enveloppe des boules (EdB) centrées sur l'interface à un instant donné.
Pour cela, on tire des observations sur lesquelles on se basera pour construire dans un premier temps un sous-ensemble de l'enveloppe des sphères (EdS), duquel on retirera dans un second temps les régions qui sont exclues de l'EdB.
\par
Dans ce chapitre, on explicite chaque étape de l'algorithme mais les détails de la mise en \oe uvre numérique font l'objet du chapitre suivant.




%[Convexité des courbes singulières (foreshadowing Hohmeyer), EdB $\subset$ EdS ($\to$ \autoref{section:principe_huygens}?), notion d'EdS partielle suffisante (ou \guillemets{pseudo-EdS}, \cf notes Huygens)]

\section{Convexité des courbes singulières}
\label{section:def_convexite_courbe_singuliere}
[Objectif : formaliser la notion de convexité d'une courbe singulière de $\Sigma$ (qui servira pour simplifier la construction de l'EdB) et démontrer que la convexité est "continue", \ie que deux segments d'une même courbe singulière, l'un convexe et l'autre concave, sont nécessairement séparés par un point régulier de $\Sigma$]
%\par\bigskip
%\begin{enumerate}
%	\item $\Sigma$ 2-variété donc tout $\p \in \Sigma$ possède un voisinage $\neigborhood$ homéomorphe à un disque
%	\item si $\p$ est à l'intérieur d'une courbe singulière $\Gamma$ de $\Sigma$, alors $\neigborhood = 
%        \left(\neigborhood \cap \Sigma_1\right) \cup
%        \left(\neigborhood \cap \Gamma\right) \cup 
%        \left(\neigborhood \cap \Sigma_2\right)$
%	\item 
%\end{enumerate}
%\def\p{\vit{p}}
%Puisque $\Sigma$ est une variété de dimension 2 sans bord, chaque point $\p$ de $\Sigma$ possède un voisinage $\neigborhood$ homéomorphe à un disque.
%Si $\p$ est situé à l'intérieur d'une courbe singulière $\Gamma$ de $\Sigma$, alors ce voisinage peut être décomposé comme
%\begin{equation}
%    \neigborhood = 
%        \left(\neigborhood \cap \Sigma_1\right) \cup
%        \left(\neigborhood \cap \Gamma\right) \cup 
%        \left(\neigborhood \cap \Sigma_2\right),
%\end{equation}
%où $\Sigma_1$ et $\Sigma_2$ désignent deux nappes régulières (qui peuvent éventuellement être confondues) adhérentes à $\p$ (une à gauche et une à droite de $\Gamma$).
%
%\begin{figure}
%    \centering
%    \includegraphics[width=5cm]{voisinage_courbe_singuliere.png}
%    \caption{Voisinage d'un point sur une courbe singulière.}
%\end{figure}



\section{Observations}%/Motivations}
[Objectif : justifier en quoi la construction intermédiaire d'une \guillemets{EdS partielle} (sous-ensemble de l'EdS qui contient l'EdB) permet de simplifier la construction d'un modèle \brep\ de l'EdB en évitant de construire des éléments de l'EdS qui sont trivialement exclues de l'EdB]
\par
définitions : 
\begin{itemize}
	\item \textit{zone d'influence}\footnote{\label{note_vocabulaire_notation}vocabulaire et notation à préciser \ldots} de $H \subseteq \Sigma$ sur l'EdB  (lieu des points de tangence entre $\EdB{\Sigma}{\rho}$ et $\sphere[H][\rho]$)
	\[ \influEdB{H}{\rho} := \EdB{\Sigma}{\rho} \cap \sphere[H][\rho] \]
	\item \textit{EdS propre}\footref{note_vocabulaire_notation} de $H \subseteq \Sigma$ 
	\[ \EdSpropre{H}{\rho} := \closure{ {\EdS{H}{\rho} \setminus \EdS{\boundary{H}}{\rho}} } \]
\end{itemize}
arguments :
\begin{enumerate}
	\item on sait décrire l'EdB simplement de manière \textit{implicite} (\cf \autoref{section:principe_huygens}) mais on cherche à en construire une représentation \textit{explicite}
	\item en revanche, on peut décrire explicitement l'EdS de chaque carreau ($\to$ introduire système définissant l'EdS à 2 paramètres)
	\item il est plus commode de voir l'EdS d'un carreau comme (un sous-ensemble de) la réunion de 10 nouveaux carreaux (intérieur $\to 2$ , bords $\to 4$ et ``coins'' $\to 4$)
	\item si on procède ainsi pour chaque carreau qui décrit l'interface, on construit beaucoup de nouveaux carreaux qui sont redondants, voire même trivialement exclus de l'EdB
%	\item la zone d'influence sur l'EdB d'une courbe singulière concave est vide (preuve?) (\ie cette courbe ne contribue pas à l'EdB et peut donc être ignorée)
%	\item la zone d'influence sur l'EdB d'une courbe singulière convexe $\Gamma$ est incluse dans la portion de son EdS qui est tangente aux EdS des deux nappes adhérentes à $\Gamma$ (preuve?), on appelle cette portion \textit{pseudo-EdS}\footref{note_vocabulaire_notation} de $\Gamma$ et on la note $\pseudoEdS{\Gamma}{\rho}$
	\item La zone d'influence sur l'EdB d'une courbe $\Gamma \subset \Sigma$ adhérente aux nappes régulières $\Left{\Sigma}$ et $\Right{\Sigma}$ est incluse dans le lieu des points de tangence entre $\EdS{\Gamma}{\rho}$, $\EdS{\Left{\Sigma}}{\rho}$ et $\EdS{\Right{\Sigma}}{\rho}$. On appelle ce lieu \textit{pseudo-EdS}\footref{note_vocabulaire_notation} de $\Gamma$ et on le note $\pseudoEdS{\Gamma}{\rho}$.
	\begin{proof}
		En posant\footnote{introduire ces notations dans la \autoref{section:principe_huygens}.}
		\[
			\implicitsphere(\bx, \p) := \normtwo{\bx - \p}^2 - \rho(\p)^2,
		\]
		et, pour $H \subseteq \Sigma$, 
		\[
			\implicitEdB{H}(\bx) := \min_{\p \in H} \implicitsphere(\bx, \p),
		\]
		on veut démontrer que 
		\[
			\influEdB{\Gamma}{\rho} \subseteq 
			\left\{
				\bx \in \complement{\Omega} \mid \implicitEdB{\Gamma}(\bx) = \implicitEdB{\Left{\Sigma}}(\bx) = \implicitEdB{\Right{\Sigma}}(\bx) = 0
			\right\}
			\subseteq \pseudoEdS{\Gamma}{\rho}.
		\]
		\par
		Puisque $\Gamma \subseteq \left( \closure{\Left{\Sigma}} \cap \closure{\Right{\Sigma}} \right)$, on a $\implicitEdB{\Gamma} \geq \implicitEdB{\Left{\Sigma}}$ et $\implicitEdB{\Gamma} \geq \implicitEdB{\Right{\Sigma}}$.\par
		Or, si $\bx \in \influEdB{\Gamma}{\rho}$ alors\footnote{car $\forall \bx \in \EdB{\Sigma}{\rho}, \implicitEdB{\Gamma}(\bx) \geq 0$ et $\forall \bx \in \sphere[\Gamma][\rho], \implicitEdB{\Gamma}(\bx) \leq 0$.} $\implicitEdB{\Gamma}(\bx) = 0$ et donc $\implicitEdB{\Left{\Sigma}}(\bx) \leq 0$ et $\implicitEdB{\Right{\Sigma}}(\bx) \leq 0$.\par
		Mais si $\implicitEdB{\Left{\Sigma}} < 0$ ou $\implicitEdB{\Right{\Sigma}} < 0$ alors\footnote{car $\forall H \subseteq \Sigma, \forall \bx \in \EdB{\Sigma}{\rho}, \implicitEdB{H}(\bx) \geq 0$.} $\bx \notin \EdB{\Sigma}{\rho}$ et donc $\bx \notin \influEdB{\Gamma}{\rho}$.\par
		Donc si $\bx \in \influEdB{\Gamma}{\rho}$ alors $\implicitEdB{\Left{\Sigma}}(\bx) = 0$ et $\implicitEdB{\Right{\Sigma}}(\bx) = 0$.
	\end{proof}
	
	\item Si $\Gamma$ est une courbe singulière concave de $\Sigma$ alors sa zone d'influence sur l'EdB est vide (\ie $\Gamma$ ne contribue pas à l'EdB et peut donc être ignorée).
	\begin{proof}
		On veut montrer que $\influEdB{\Gamma}{\rho} = \varnothing$ (piste : montrer que si $\Gamma$ est concave alors, pour $\bx \in \complement{\Omega}$, $\implicitEdB{\Gamma}(\bx) = 0 \Rightarrow \implicitEdB{\Left{\Sigma}}(\bx) < 0$ ou $\implicitEdB{\Right{\Sigma}}(\bx) < 0$) [\ldots]
	\end{proof}
	
	\item si toutes les courbes singulières adhérentes à un point singulier sont concaves alors la zone d'influence sur l'EdB de ce point est vide (preuve?) (\ie ce point ne contribue pas à l'EdB et peut donc être ignoré)
	\item si toutes les courbes singulières adhérentes à un point singulier $\p$ \textit{ne sont pas} concaves (ou bien que $\p$ n'est adhérent à aucune courbe singulière, \eg le sommet d'un cône) on dit que $\p$ est convexe et sa zone d'influence sur l'EdB est la portion de $\sphere[\p][\rho(\p)]$ qui est tangente aux EdS de toutes les courbes singulières adhérentes à $\p$ (preuve?). On appelle cette portion \textit{pseudo-EdS}\footref{note_vocabulaire_notation} de $\p$ et on la note $\pseudoEdS{\p}{\rho}$.
	\item l'EdB est incluse dans la réunion
	\begin{itemize}
		\item des EdS propres des nappes régulières, qui sont elles-mêmes contenues dans la réunion des EdS propres des faces \brep
		\item des pseudo-EdS des courbes singulières convexes, qui sont elles-mêmes contenues dans la réunion des pseudo-EdS des arêtes \brep\ convexes
		\item des pseudo-EdS des points singuliers convexes, qui sont elles-mêmes contenues dans la réunion des pseudo-EdS des sommets \brep\ convexes
	\end{itemize}
	\item[$\Rightarrow$] on construit d'abord une telle réunion (que l'on appelle \textit{EdS partielle}\footref{note_vocabulaire_notation}) puis on en élimine les régions qui sont exclues de l'EdB (au passage on constitue les relations topologiques qui assurent la validité du modèle \brep)
\end{enumerate}

\input{figures/code/pseudo_EdS_arete/pseudo_EdS_arete_vue_coupe.tex}






\section{Construction d'une EdS partielle}
\label{section:construction_EdS_partielle}
\label{section:def_canal_surface}

[Objectif : donner les étapes de la construction d'une EdS partielle sous la forme d'un ensemble de carreaux restreints (paramétrisation + courbes de restriction du domaine paramétrique) avec des relations d'adjacences partielles)]

\textit{Graphe des intersections} : en réalité 2 graphes
\begin{enumerate}
	\item graphe points d'intersection-courbes d'intersection
	\item graphe carreaux-courbes d'intersection
\end{enumerate}

\begin{enumerate}
	\item construction d'un ensemble de carreaux restreints suffisant pour décrire l'EdB 
	\item construction du graphe des intersections tangentielles entre ces carreaux
	\begin{itemize}
		\item le calcul numérique des intersections tangentielles pose généralement des difficultés d'efficacité et de robustesse
		\item avec l'approche choisie, il est aisé de construire explicitent ces courbes et points intersections simultanément à la construction des carreaux puisqu'on connaît la nature de ces derniers (EdS propre de face, pseudo-EdS d'arête ou de sommet), qui perdue par la suite $\Rightarrow$ de cette façon, on simplifie significativement le futur calcul des intersections
	\end{itemize}
\end{enumerate}



\subsection{Représentation de l'EdS propre d'une face \brep}% carreau paramétrique restreint}
\label{section:parametrisation_eds_propre_face}
\def\indice{_0}
\def\carreau{\Sigma\indice}
\def\face{\brepface\indice}

\subsubsection{Paramétrisation de l'EdS propre d'un carreau paramétrique}
\begin{enumerate}
	\item paramétrisation $\eos$ de l'EdS propre d'un carreau non-restreint $\carreau \colon (\left[\lo{u},\hi{u}\right] \times \left[\lo{v},\hi{v}\right], \bs)$
	\begin{enumerate}
		\item rappeler système définissant une EdS propre à 2 paramètres
		\begin{subequations}
			\label{eq:sys_envelope_of_spheres}
			\begin{empheq}[left={\empheqlbrace\,}]{align}
				\implicitsphere_{\rho}(\eos(u,v), \bs(u,v)) &= 0, \label{eq:sys_envelope_of_spheres_Sphere} \\%[\sysvspace]
				\frac{\partial }{\partial u}\implicitsphere_{\rho}(\eos(u,v), \bs(u,v)) &= 0, \label{eq:sys_envelope_of_spheres_PlaneU} \\%[\sysvspace]
				\frac{\partial }{\partial v}\implicitsphere_{\rho}(\eos(u,v), \bs(u,v)) &= 0. \label{eq:sys_envelope_of_spheres_PlaneV}
			\end{empheq}
		\end{subequations}				
		\item interprétation : intersection de cercles caractéristiques (voir figure \autoref{fig:EdS_propre_carreau}) $\to$ 2 points (\ie 2 nouveaux carreaux), on garde celui dans le sens de $+\unv$ (\ie $\EdSpropreplus{\carreau}{\rho}$, l'autre ($\EdSpropremoins{\carreau}{\rho}$) est trivialement exclu de l'EdB)
		\item paramétrisation à la Gelston \cite{gelston1995} : \\
		En considérant $\rho$ comme une fonction des paramètres $u$ et $v$, on peut réécrire le système \eqref{eq:sys_envelope_of_spheres} 
		\begin{subequations}
			%\label{eq:sys_envelope_of_spheres}
			\begin{empheq}[left={\empheqlbrace\,}]{align}
				\normtwo{\eos - \bs}^2 - \rho^2 &= 0, \\
				\dotprod{\left( \eos - \bs \right)}{\left( \eos_u - \bsu \right)} - \rho \rho_u &= 0,\\
				\dotprod{\left( \eos - \bs \right)}{\left( \eos_v - \bsv \right)} - \rho \rho_v &= 0.
			\end{empheq}
		\end{subequations}	
		%Or $\eos - \bs$ est orthogonal à la sphère $\sphere[\bs][\rho]$ et donc aussi à $\EdSpropre{\carreau}{\rho}$.
		Or $\eos - \bs$ est un rayon de la sphère $\sphere[\bs][\rho]$ et est donc orthogonal à $\EdSpropre{\carreau}{\rho}$ en $\eos$.
		Donc $\dotprod{\left( \eos - \bs \right)}{\eos_u} = \dotprod{\left( \eos - \bs \right)}{\eos_v} = 0$ et on a finalement
		\begin{subequations}
			%\label{eq:sys_envelope_of_spheres}
			\begin{empheq}[left={\empheqlbrace\,}]{align}
				\normtwo{\eos - \bs}^2 - \rho^2 &= 0, \\
				\dotprod{\left( \eos - \bs \right)}{\bsu} + \rho \rho_u &= 0,\\
				\dotprod{\left( \eos - \bs \right)}{\bsv} + \rho \rho_v &= 0.
			\end{empheq}
		\end{subequations}	
%		\begin{equation}
%		    \left\{\begin{matrix}
%		        \normtwo{\eos - \bs}^2 - \rho^2 &= 0, \\
%		        \dotprod{\left( \eos - \bs \right)}{\bsu} + \rho \rho_u &= 0, \\
%		        \dotprod{\left( \eos - \bs \right)}{\bsv} + \rho \rho_v &= 0.
%		    \end{matrix}\right.
%		\end{equation}
		On cherche alors une paramétrisation de la forme
		\begin{equation}
			\eos(u,v) = \bs(u,v) + \rho(u,v) \unv_{\envelope}(u,v),
		\end{equation}
		où $\unv_{\envelope}$ est la direction normale à $\EdSpropre{\carreau}{\rho}$, qui vérifie
		\begin{subequations}
			\begin{empheq}[left={\empheqlbrace\,}]{align}
				\normtwo{\unv_{\envelope}}       &= 1,        \\
				\dotprod{\unv_{\envelope}}{\bsu} &= -\rho_u , \\
				\dotprod{\unv_{\envelope}}{\bsv} &= -\rho_v .
			\end{empheq}
		\end{subequations}	
		On décompose $\unv_{\envelope} = \mathrm{n}_u \bsu + \mathrm{n}_v \bsv + \mathrm{n}_n \unv$, où $\unv = \unitized{\crossprod{\bsu}{\bsv}}$.\\
		Puisque $\dotprod{\bsu}{\unv} = \dotprod{\bsv}{\unv} = 0$, on a 
		\[
			\transpose{\jacobian{\bs}} \unv_{\envelope} = \fff_{\bs} \colvec{\mathrm{n}_u \\ \mathrm{n}_v} = -\colvec{\rho_u \\ \rho_v}.
		\]
		Si on pose $\bt = \jacobian{\bs} \colvec{\mathrm{n}_u \\ \mathrm{n}_v}$ (on a alors $\unv_{\envelope} = \bt + \mathrm{n}_n \unv$), on a
		\[
			\bt = - \jacobian{\bs} \inverse{ \left(\fff_{\bs}\right) } \colvec{\rho_u \\ \rho_v},
		\]
		soit
		\[
			\bt = \frac{
				\left( \rho_v I_{1,2} - \rho_u I_{2,2} \right) \bsu + 
				\left( \rho_u I_{1,2} - \rho_v I_{1,1} \right) \bsv
			}{
				\determinant{\fff_{\bs}}
			}.
		\]
		Si $\normtwo{\bt} \leq 1$ alors on a $\unv_{\envelope}^{\pm} = \bt \pm \sqrt{1 - \normtwo{\bt}^2} \unv$.
				
		\item différence avec le simple transport suivant la normale $\to$ abordé dans la \autoref{section:discretisation_EdS_propre_carreau}
	\end{enumerate}
\end{enumerate}

\input{figures/code/EdS_propre_carreau/EdS_propre_carreau.tex}


\subsubsection{Courbes de restriction \ldots}
\begin{enumerate}
	\item conservation du domaine paramétrique (pas de re-paramétrisation) $\Rightarrow$ coordonnées $(x,y,z)$ des courbes de restriction données directement par la nouvelle paramétrisation (voir \autoref{fig:EdS_propre_carreau_restreint}).
	\item on ajoute au graphe des intersections tangentielles celles parmi ces courbes de restriction qui correspondent à des intersections tangentielles\\
	(argument : la zone d'influence sur l'EdB d'un point régulier de $\Sigma$ est incluse dans un point, donc si $\p = \bs^1(u_1,v_1) = \bs^2(u_2,v_2)$ est un point d'intersection entre les faces $\brepface_1$ et $\brepface_1$ tel qu'elles y on la même direction normale alors leurs EdS propres s'intersectent aussi au point $\q = \eos^1(u_1,v_1) = \eos^2(u_2,v_2)$ où elles partagent la même direction normale.) 
\end{enumerate}




\begin{figure}
	\centering
	%\includegraphics[width=10cm]{EdS_propre_carreau_restreint.JPG}
	\input{figures/code/EdS_propre_carreau_restreint/EdS_propre_carreau_restreint.tex}
	\caption{EdS propre d'un carreau paramétrique restreint.}
	\label{fig:EdS_propre_carreau_restreint}
\end{figure}



\subsection{Représentation de la pseudo-EdS d'une arête \brep\ convexe}% arc paramétrique}
%\begin{enumerate}
%	\item détermination de la convexité de l'arête (signe de $\dotprod{\left(\crossprod{\unv_L}{\unv_R}\right)}{\bt}$, \cf \autoref{section:def_convexite_courbe_singuliere})
%	\item rappeler système définissant une EdS propre à 1 paramètre
%	\item notion de cercle caractéristique
%	\item paramétrisation générique $\eos(u,v) = \bo(u) + r(u)\br(u,v)$ de l'EdS propre
%	\item restriction à la portion entre les EdS propres des faces incidentes, paramétrisée sur le domaine $\uvdomain = \left[ \lo{u}, \hi{u} \right] \times \left[ \lo{v}, \hi{v} \right]$
%\end{enumerate}

\subsubsection{Paramétrisation de l'EdS propre d'un arc paramétrique}
\label{section:parametrisation_EdS_propre_courbe}
%\begin{figure}
%	\centering
%	\setlength{\imagewidth}{120mm}%
%	\setlength{\imageheight}{0.6857\imagewidth}%
%	\definecolor{coloreos}{HTML}{64CF36}
%	\definecolor{colorshpere}{HTML}{CD6E33}
%	\begin{tikzpicture}[x=\imagewidth, y=\imageheight]
%		\node[inner sep=0, anchor=south west] {\includegraphics[width=\imagewidth]{figures/images/EdS_propre_courbe.png}};
%		\node[coloreos] at (0.55,0.95) {$\EdSpropre{\Gamma}{\rho}$};
%		\node[anchor=south west, colorshpere] at (0.46,0.62) {$\sphere[u]$};
%	\end{tikzpicture}
%	\caption{Paramétrisation de l'EdS propre d'un arc paramétrique.}
%	%\label{fig:parametrisation_EdS_propre_courbe}
%\end{figure}

\input{figures/code/EdS_propre_courbe/EdS_propre_courbe.tex}

%%Soit $\bg : \wdomain \to \reals^3$ une paramétrisation du support géométrique $\Gamma$ de l'arête $\brepedge$. 
%%L'EdS propre de $\Gamma$ est le lieu des points $\bx \in \reals^3$ qui vérifient
%L'enveloppe $\Phi$ d'une famille de sphères à un paramètre centrées sur une courbe directrice $\Gamma$ est appelée \textit{surface canal} \cite{monge1850}. 
%Si la $\Gamma$ dispose d'une paramétrisation $\bg : \wdomain \to \reals^3$ alors cette surface est le lieu des points $\bx \in \reals^3$ qui vérifient
%\begin{equation}
%  \left\{
%    \begin{matrix}
%        \normtwo{\bx - \bg(u)}^2 - \rho(u)^2 &= 0 ,\\ 
%        \dotprod{\left(  \bx - \bg(u) \right)}{\bg'(u)} + \rho(u)\rho_u(u) &= 0.
%    \end{matrix}
%  \right.
%  \label{eq:sys_canal_surface}
%\end{equation}
Soit $\bg : \left[ \lo{u}, \hi{u} \right] \to \reals^3$ une paramétrisation du support géométrique $\Gamma$ de l'arête $\brepedge$. 
Si l'on considère $\rho$ comme une fonction du paramètre $u$ alors $\EdSpropre{\Gamma}{\rho}$ est le lieu des points $\bx \in \reals^3$ qui vérifient
%\begin{equation}
%  \left\{
%    \begin{matrix}
%        \normtwo{\bx - \bg(u)}^2 - \rho(u)^2 &= 0 ,\\ 
%        \dotprod{\left(  \bx - \bg(u) \right)}{\bg'(u)} + \rho(u)\rho_u(u) &= 0.
%    \end{matrix}
%  \right.
%  \label{eq:sys_canal_surface}
%\end{equation}
\begin{subequations}
	\label{eq:sys_canal_surface}
	\begin{empheq}[left={\empheqlbrace\,}]{align}
		\normtwo{\bx - \bg(u)}^2 - \rho(u)^2 &= 0 ,\\ 
		\dotprod{\left(  \bx - \bg(u) \right)}{\bg'(u)} + \rho(u)\rho_u(u) &= 0.
	\end{empheq}
\end{subequations}	
A condition que $\rho_u^2 \leq \normtwo{\bg'}^2$, le système \eqref{eq:sys_canal_surface} définit une famille de \textit{cercles caractéristiques}, dont chacun est le lieu des points de tangence entre $\EdSpropre{\Gamma}{\rho}$ et une sphère de la famille $\sphere[\Gamma][\rho]$ (voir \autoref{fig:parametrisation_EdS_propre_courbe}).
\par
D'après \eqref{eq:sys_canal_surface}, le cercle caractéristique $\circlenotation(u)$ au point $\bg(u)$ est l'intersection de la sphère $\sphere[u] = \sphere[\bg(u)][\rho(\bg(u))]$ et d'un plan orthogonal à la direction tangente à $\Gamma$ en ce point (donnée par le vecteur $\bg'(u)$). 
Ce cercle est centré en
\begin{equation}
    \bo(u) = \bg(u) - \frac{\rho(u)\rho_u(u)}{\normtwo{\bg'(u)}^2} \bg'(u),
    \label{eq:cercle_caracteristique_centre}
\end{equation}
et a pour rayon
\begin{equation}
    r(u) = \rho(u) \sqrt{1 - \frac{\rho_u(u)^2}{\normtwo{\bg'(u)}^2}}.
    \label{eq:cercle_caracteristique_rayon}
\end{equation}
\par
Voir $\EdSpropre{\Gamma}{\rho}$ comme une famille cercles caractéristiques permet d'en donner la paramétrisation suivante
\begin{equation}
    \eos(u,v) = \bo(u) + r(u)\br(u,v),
    \label{eq:parametrisation_EdS_propre_courbe}
\end{equation}
où $\br$ vérifie
\begin{equation}
	\left\{
		\begin{matrix}
			\normtwo{\br} = 1,\\ 
			\dotprod{\br}{\bg'} = 0.
		\end{matrix}
	\right.
	\label{eq:parametrisation_EdS_propre_courbe_condition_r}
\end{equation}
De cette façon, les courbes iso-$u$ de $\eos$ sont les cercles caractéristiques.


%\subsubsection{Paramétrisation de la pseudo-EdS}
\subsubsection{Ajustement d'un carreau paramétrique (non-restreint)}
\label{section:parametrisation_pseudo_EdS_arete}

%\begin{figure}
%    \centering
%    \includegraphics[width=10cm]{pseudo-EdS_arete.JPG}
%    \caption{Paramétrisation de $\pseudoEdS{\brepedge}{\rho}$}
%    \label{fig:pseudo-EdS_arete}
%\end{figure}
\input{figures/code/pseudo_EdS_arete/pseudo_EdS_arete.tex}

\begin{enumerate}
	\item $\brepedge$ une arête convexe du modèle \brep\ de $\Sigma$, $\bg : \left[ \lo{u}, \hi{u} \right] \to \reals^3$ une paramétrisation de son support géométrique
	\item $\Right{\brepface}$ (resp. $\Left{\brepface}$) la face à gauche\footnote{relativement à l'orientation donnée par $\bg$, vu de l'extérieur de $\Omega$.} (resp. à droite) de $\brepedge$
	\item but : construire une paramétrisation $\eos^{\brepedge}$ de la pseudo-EdS de $\brepedge$, \ie la région $\pseudoEdS{\brepedge}{\rho}$ de $\EdS{\brepedge}{\rho}$ qui est tangente à la fois à $\EdS{\Right{\brepface}}{\rho}$ et $\EdS{\Left{\brepface}}{\rho}$ (voir \autoref{fig:pseudo-EdS_arete})
	\item on note $\Right{\bs}$ (resp. $\Left{\bs}$) une paramétrisation du carreau supportant $\Right{\brepface}$ (resp. $\Left{\brepface}$) et $\Right{\bp}$ (resp. $\Left{\bp}$) une paramétrisation de la trace de $\brepedge$ dans l'espace paramétrique de $\Right{\brepface}$ (resp. de $\Left{\brepface}$) telle que
	\begin{equation}
	    \bg = \Right{\bs} \circ \Right{\bp} = \Left{\bs} \circ \Left{\bp}.
	\end{equation}
	\item on note $\eos^{\Right{\brepface}}$ (resp. $\eos^{\Left{\brepface}}$) la paramétrisation de $\EdSpropreplus{\Right{\brepface}}{\rho}$ (resp. de $\EdSpropreplus{\Left{\brepface}}{\rho}$) obtenue comme décrit dans la \autoref{section:parametrisation_eds_propre_face}. 
	\item enfin, on note
	\begin{equation}
	    \Right{\eos} = \eos^{\Right{\brepface}} \circ \Right{\bp} \quad\text{et}\quad \Left{\eos} = \eos^{\Left{\brepface}} \circ \Left{\bp}.
	    \label{eq:pseudoEdSarete_courbes_limites}
	\end{equation}
	
	\item On choisit une paramétrisation de la forme \eqref{eq:parametrisation_EdS_propre_courbe}, \ie les courbes iso-$u$ sont des arcs de cercles caractéristiques dont les extrémités $\Right{\eos}$ et $\Left{\eos}$ sont respectivement atteintes en $v = \lo{v}$ et $v = \hi{v}$. 
Le domaine paramétrique du carreau décrivant $\pseudoEdS{\brepedge}{\rho}$ est donc le rectangle $\mathcal{U} = \left[ \lo{u}, \hi{u} \right] \times \left[ \lo{v}, \hi{v} \right]$.

	%\item on suppose que l'on peut évaluer $\bg(u)$, $\Right{\eos}(u)$ et $\Left{\eos}(u)$ pour tout $u \in \left[ \lo{u}, \hi{u} \right]$
	
	\item on propose alors une méthode pour construire une telle paramétrisation qui n'exploite pas directement la donnée de $\rho$ et $\rho_u$ mais plutôt celle de $\Right{\eos}(u)$ et $\Left{\eos}(u)$ (ce choix, qui sera motivé lors de la mise en \oe uvre numérique, garantit que $\eos^{\brepedge}(u,\lo{v}) = \Right{\eos}(u)$ et $\eos^{\brepedge}(u,\hi{v}) = \Left{\eos}(u)$)

	\item on note $\bt = \unitized{\bg'}$ et $\mu = -\frac{\rho \rho_u}{\normtwo{\bg}}$, on a alors $\bo = \bg + \mu \bt$
	
	\item or $\mu = \dotprod{\left( \Right{\eos} - \bg \right)}{\bt} = \dotprod{\left( \Left{\eos} - \bg \right)}{\bt}$ %(pour l'implémentation, on choisit $\mu = \frac{1}{2} \dotprod{\left( \Right{\eos} + \Left{\eos} - 2 \bg\right)}{\bt}$)
		
	\item on a $r = \normtwo{\Right{\eos} - \bo} = \normtwo{\Left{\eos} - \bo}$ (rayon du cercle caractéristique) %(pour l'implémentation, on choisit $r(u,v) = \left( 1 - \frac{v - \lo{v}}{\hi{v} - \lo{v}} \right) \normtwo{\Right{\eos} - \bo} + \frac{v - \lo{v}}{\hi{v} - \lo{v}} \normtwo{\Left{\eos} - \bo}$)
	
	\item on note $\Right{\br} = \unitized{\Right{\eos} - \bo}$ et $\Left{\br} = \unitized{\Left{\eos} - \bo}$
	
	\item on définit $\Right{\br}^{\perp} = \crossprod{\Right{\br}}{\bt}$ (de telle sorte que $\left( \Right{\br}, \Left{\br}^{\perp}, -\bt \right)$ forme un trièdre orthonormé direct)
	
	\item on note $\theta \in \left[0, 2\pi\right[$ l'angle entre les vecteurs $\Right{\br}$ et $\Left{\br}$ mesuré dans le sens direct autour de $-\bt$, \ie
	\begin{equation}
	    \theta = 
	    \begin{cases}
	       \vartheta + 2\pi & \text{ si } \vartheta < 0, \\ 
	       \vartheta        & \text{ si } \vartheta \geq 0,
	    \end{cases}
	\end{equation}
	où
	\begin{equation}
		\vartheta = \arctan \left(
			\frac{
        		\dotprod{\Left{\br}}{\Right{\br}^{\perp}}    	
			}{
				\dotprod{\Left{\br}}{\Right{\br}}
			}
		\right).
	\end{equation}
	
	\item Enfin, on choisit une paramétrisation naturelle pour l'arc de cercle caractéristique $\eos^{\brepedge}(u, \left[\lo{v},\hi{v}\right])$, \ie
%	\begin{equation}
%	    \br(u,v) = 
%	        \cos\left( \lambda(v) \theta(u) \right) \Right{\br}(u) +
%	        \sin\left( \lambda(v) \theta(u) \right) \Right{\br}^{\perp}(u),
%	\end{equation}
%	avec 
%	\begin{equation}
%	    \lambda(v) = \frac{v - \lo{v}}{\hi{v} - \lo{v}} \in \left[0, 1\right].
%	\end{equation}
	\begin{equation}
	    \br(u,v) = 
	        \cos\left( \frac{v - \lo{v}}{\hi{v} - \lo{v}} \theta(u) \right) \Right{\br}(u) +
	        \sin\left( \frac{v - \lo{v}}{\hi{v} - \lo{v}} \theta(u) \right) \Right{\br}^{\perp}(u).
	\end{equation}	
	De cette façon, $\br$ vérifie bien les conditions \eqref{eq:parametrisation_EdS_propre_courbe_condition_r} et on a bien $\br(u,\lo{v}) = \Right{\br}(u)$ et $\br(u,\hi{v}) = \Left{\br}(u)$ (donc $\eos^{\brepedge}(u,\lo{v}) = \Right{\eos}(u)$ et $\eos^{\brepedge}(u,\hi{v}) = \Left{\eos}(u)$).
	
	\item \textit{Remarque :} si une extrémité de $\brepedge$ est un point régulier de $\Sigma$ alors l'arc de cercle caractéristique en cette extrémité est réduit à un seul point et la paramétrisation $\eos^{\brepedge}$ y est singulière\\
	$\to$ un moyen d'y remédier serait d'utiliser un carreau restreint (\ie les courbes $\Right{\eos}$ et $\Left{\eos}$ ne correspondent plus aux courbes $v = \lo{v}$ et $v = \hi{v}$)
	
	\item on ajoute au graphe des intersections tangentielles les courbes d'intersection suivantes :
	\begin{enumerate}
		\item les carreaux $\pseudoEdS{\brepedge}{\rho}$ et $\EdSpropreplus{\Right{\brepface}}{\rho}$ s'intersectent le long de la courbe $\Right{\eos}(\intervalLoHi{u}) = \eos^{\brepedge}(\intervalLoHi{u}, \lo{v}) = \left( \eos^{\Right{\brepface}} \circ \Right{\bp} \right) (\intervalLoHi{u})$ ;
		\item les carreaux $\pseudoEdS{\brepedge}{\rho}$ et $\EdSpropreplus{\Left{\brepface}}{\rho}$ s'intersectent le long de la courbe $\Left{\eos}(\intervalLoHi{u}) = \eos^{\brepedge}(\intervalLoHi{u}, \hi{v}) = \left( \eos^{\Left{\brepface}} \circ \Left{\bp} \right) (\intervalLoHi{u})$ ;
		\item si les arêtes $\brepedge_1$ et $\brepedge_2$ partagent un sommet où elles ont la même direction tangente (\ie $\brepedge_1$ et $\brepedge_2$ sont sur une même courbe singulière de $\Sigma$) alors les carreaux $\pseudoEdS{\brepedge_1}{\rho}$ et $\pseudoEdS{\brepedge_2}{\rho}$ s'intersectent le long de l'arc caractéristique associé à leur sommet commun.
	\end{enumerate}
	
\end{enumerate}



\subsection{Représentation de la pseudo-EdS d'un sommet \brep\ convexe}
\def\v{\vit{v}}

%Soit $\brepvertex$ un sommet convexe du modèle \brep\ de $\Sigma$ dont le support géométrique est le point $\v \in \reals^3$. 
%On cherche à construire un ou plusieurs carreaux paramétriques (restreints ou non) décrivant $\pseudoEdS{\v}{\rho}$ \ie la région de la sphère $\sphere[\v][\rho(\v)]$ délimitée par les arcs de cercles caractéristiques aux extrémités des arêtes \brep\ incidentes à $\brepvertex$.\par
%On propose deux approches, en en donnant le principe ainsi que les avantages et les inconvénients.

La pseudo-EdS $\pseudoEdS{\brepvertex}{\rho}$ d'un sommet convexe $\brepvertex$ ayant pour support géométrique le point $\v$ est la région de la sphère $\sphere[\v][\rho(\v)]$ qui est tangente à l'EdS de chacune des arêtes $\family{\brepedge}{i}{0}{m-1}$ incidentes à $\brepvertex$.
Cette région est le lieu des points $\bx$ vérifiant 
\begin{subequations}
	\label{eq:sys_pseudoEdS_sommet}
	\begin{empheq}[left={\empheqlbrace\,}]{align}
		\normtwo{\bx - \v} &= \rho(\v), \\ 
		\dotprod{\left(  \bx - \lo{\bo}_i \right)}{\lo{\bt}_i} &\leq 0 \quad (i = 0, \ldots, m-1), 
	\end{empheq}
\end{subequations}

%où $\lo{\bo}_i$ et $\lo{\bt}_i$ désignent respectivement le centre et la normale au plan contenant le cercle caractéristique de l'arête incidente $\brepedge_i$ en son extrémité correspondant à $\brepvertex$ (\cf \autoref{section:parametrisation_pseudo_EdS_arete}).
où $\lo{\bo}_i$ désigne le centre du cercle caractéristique de l'arête incidente $\brepedge_i$ en son extrémité correspondant à $\brepvertex$ et $\lo{\bt}_i$ la normale au plan contenant ce cercle, orientée vers l'intérieur de $\brepedge_i$ (\cf \autoref{section:parametrisation_pseudo_EdS_arete}).
\par
$\pseudoEdS{\brepvertex}{\rho}$ est donc l'intersection de $\sphere[\v][\rho(\v)]$ et de $m$ demi-espaces délimités par les plans contenant les arcs de cercles caractéristiques des arêtes incidentes.
\par
Si $\gradient{\rho}(\v) = \vit{0}$ alors $\lo{\bo}_i = \v$  pour $i = 0, \ldots, m-1$ donc ces arcs caractéristiques sont des arcs de grands cercles sur $\sphere[\v][\rho(\v)]$ et donc $\pseudoEdS{\brepvertex}{\rho}$ est un polygone sphérique. 
En revanche, dans le cas général ces plans ne passent pas par $\v$.
\par
On cherche à construire un ou plusieurs carreaux paramétriques (restreints ou non) décrivant $\pseudoEdS{\v}{\rho}$.
%Afin de simplifier cette construction, on suppose sans restreindre la généralité que $\v$ est situé à l'origine et que $\rho(\v) = 1$. 
%On peut toujours se ramener à ce cas à l'aide d'une transformation adéquate (translation et homothétie) que l'on inversera en fin de construction pour se placer à nouveau dans le cas général.
\par
On note respectivement $\family{\brepedge}{i}{0}{m-1}$ et $\family{\brepface}{i}{0}{m-1}$ les arêtes et les faces incidentes à $\brepvertex$, que l'on suppose ordonnées dans le sens direct autour de $\brepvertex$, vu de l'extérieur de $\Omega$ (voir \autoref{fig:pseudo_EdS_sommet_quadpoly} gauche). 
On note également $\bg^{\brepedge_i}$ (resp. $\bs^{\brepface_i}$) une paramétrisation du support géométrique de $\brepedge_i$ (resp. de $\brepface_i$) et $\eos^{\brepedge_i}$ (resp. $\eos^{\brepface_i}$) celle de $\pseudoEdS{\brepedge_i}{\rho}$ (resp. de $\EdSpropreplus{\brepface_i}{\rho}$).
Enfin, on note respectivement $u_{\brepedge_i}$ et $(u_{\brepface_i}, v_{\brepface_i})$ les coordonnées paramétriques du sommet $\brepvertex$ dans $\brepedge_i$ et $\brepface_i$, \ie $\bg^{\brepedge_i}(u_{\brepedge_i}) = \bs^{\brepface_i}(u_{\brepface_i}, v_{\brepface_i}) = \v$.
%On suppose également que les arêtes $\family{\brepedge}{i}{1}{m}$ et les faces $\family{\brepface}{i}{1}{m}$ incidentes à $\brepvertex$ sont ordonnées dans le sens direct autour de $\brepvertex$, vu de l'extérieur de $\Omega$ (voir \autoref{fig:cycle_aretes_faces_incidentes}).
\par
On propose deux approches, en en donnant le principe ainsi que les avantages et les inconvénients.

%\input{figures/code/pseudo_EdS_sommet/aretes_faces_incidentes.tex}

\subsubsection{Ajustement de plusieurs carreaux non-restreints}%Polygone sphérique découpé en quadrilatères}
\label{section:quadrangulation_polygone_spherique}
Dans un premier temps, on suppose que $\rho$ est uniforme sur $\Sigma$. 

\newcommand*{\incrementnotation}[2]{#1_{\text{#2}}}%{#1\raisebox{1.15ex}{$\scriptscriptstyle{#2}$}}
\newcommand{\iplus}{\incrementnotation{i}{+}}%{i_+}
\newcommand{\imoins}{\incrementnotation{i}{--}}%{i_-}

\begin{enumerate}
	%\item hypothèse : $\rho$ est uniforme sur $\Sigma$
	\item[$\Rightarrow$] $\pseudoEdS{\v}{\rho}$ est alors le polygone sphérique formé par les $m$ points $\v + \rho \unv_i$, où $\unv_i$ désigne la direction normale à la face $\brepface_i$ au point $\v$
	\item si $m = 4$, on représente ce polygone à l'aide d'un seul carreau sphérique
	\item si $m \neq 4$, on \guillemets{quadrangule} le polygone de la manière suivante 
	\begin{itemize}
		\item on note $\vrm{q} = \unitized{\sum_{i=1}^{m-1} \unv_i}$ et $\vrm{m}_i = \unitized{\unv_i + \unv_{\iplus}}$
		\item on construit $m$ carreaux sphériques $\left\{ \pseudoEdS{\brepvertex}{\rho}[i] \right\}_{i = 1, \ldots, m-1}$ dont les \guillemets{coins} sont $\vrm{q}$, $\vrm{m}_{\imoins}$, $\unv_i$ et $\vrm{m}_i$ (voir \autoref{fig:pseudo_EdS_sommet_quadpoly} droite)
		\item avec $\iplus := (i+1)\bmod{m}$ et $\imoins := (i-1)\bmod{m}$
	\end{itemize}
	\item dans les deux cas, les carreaux sphériques sont construits en projetant sur $\sphere[\v][\rho]$ le carreau bilinéaire qui interpole ses coins
	\begin{align}
		\vit{\ell}_i(u,v) 
		    & = \frac{(\hi{u} - u) (\hi{v} - v)}{(\hi{u} - \lo{u})(\hi{v} - \lo{v})} \vrm{q}  \nonumber\\
			& + \frac{(u - \lo{u}) (\hi{v} - v)}{(\hi{u} - \lo{u})(\hi{v} - \lo{v})} \vrm{m}_{\imoins} \nonumber\\
			& + \frac{(u - \lo{u}) (v - \lo{v})}{(\hi{u} - \lo{u})(\hi{v} - \lo{v})} \unv_i     \nonumber\\
			& + \frac{(\hi{u} - u) (v - \lo{v})}{(\hi{u} - \lo{u})(\hi{v} - \lo{v})} \vrm{m}_i.
	\end{align}
	et
	\[
		\eos^{\brepvertex_i} = \v + \rho \unitized{\vit{\ell}_i}.
	\]
	
	\item on ajoute au graphe des intersections tangentielles les courbes et points d'intersection suivants :
	\begin{enumerate}
		\item les carreaux $\pseudoEdS{\brepvertex}{\rho}[i]$ et $\EdSpropreplus{\brepface_i}{\rho}$ s'intersectent au point $\v + \rho \unv_i = \eos^{\brepvertex_i}(\hi{u}, \hi{v}) = \eos^{\brepface_i}(u_{\brepface_i}, v_{\brepface_i})$ ;
%		Pour la paramétrisation $\bs_i$, ses coordonnées paramétriques sont $(\hi{u}, \hi{v})$.
%		Pour la paramétrisation de $\EdSpropreplus{\brepface_i}{\rho}$, ses coordonnées paramétriques $(u_i, v_i)$ ;
		\item tous les carreaux $\pseudoEdS{\brepvertex}{\rho}[i]$ s'intersectent au point $\v + \rho \vrm{q} = \eos^{\brepvertex_i}(\lo{u}, \lo{v})$ ;
		\item les carreaux $\pseudoEdS{\brepvertex}{\rho}[\imoins]$ et $\pseudoEdS{\brepvertex}{\rho}[i]$ s'intersectent le long de la courbe 
		\[
			\Gamma_i 
			= \eos^{\brepvertex_{\imoins}}(\lo{u}, \intervalLoHi{v})
			= \eos^{\brepvertex_i}(\intervalLoHi{u}, \lo{v}),
		\] 
		dont les extrémités sont les points $\v + \rho \vrm{q}$ et 
		$\v + \rho \vrm{m}_{\imoins} 
		= \eos^{\brepvertex_{\imoins}}(\lo{u},\hi{v}) 
		= \eos^{\brepvertex_i}(\hi{u}, \lo{v})$ ; 
		
		\item les carreaux $\pseudoEdS{\brepvertex}{\rho}[i]$ et $\pseudoEdS{\brepedge_i}{\rho}$ s'intersectent le long de la courbe (demi-arc caractéristique limite)
		\[
			\Gamma_{i,i} 
			= \eos^{\brepvertex_i}(\hi{u}, \intervalLoHi{v})
			%= \eos^{\brepedge_i}(u_{\brepedge_i}, \left[ \frac{\lo{v} + \hi{v}}{2}, \hi{v} \right]),
			= 
			\begin{cases}
				\eos^{\brepedge_i} \!\left( u_{\brepedge_i}, \left[ \frac{\lo{v} + \hi{v}}{2}, \hi{v} \right] \right) &\text{ si } u_{\brepedge_i} = \lo{u},\\
				\eos^{\brepedge_i} \!\left( u_{\brepedge_i}, \left[ \lo{v}, \frac{\lo{v} + \hi{v}}{2} \right] \right) &\text{ si } u_{\brepedge_i} = \hi{u},
			\end{cases}
		\]
		dont les extrémités sont les points 
		$\v + \rho \vrm{m}_{\imoins} = \eos^{\brepedge_i}(u_{\brepedge_i}, \frac{\lo{v} + \hi{v}}{2})$ 
		et 
		\[
			\v + \rho \unv_i 
			= \eos^{\brepvertex_i}(\hi{u}, \hi{v})
			= 
			\begin{cases}
				\eos^{\brepedge_i}(u_{\brepedge_i}, \hi{v}) &\text{ si } u_{\brepedge_i} = \lo{u}, \\ 
				\eos^{\brepedge_i}(u_{\brepedge_i}, \lo{v}) &\text{ si } u_{\brepedge_i} = \hi{u} \; ;
			\end{cases}
		\]
		\item les carreaux $\pseudoEdS{\brepvertex}{\rho}[i]$ et $\pseudoEdS{\brepedge_{\iplus}}{\rho}$ s'intersectent le long de la courbe (demi-arc caractéristique limite)
		\[
			\Gamma_{i,\iplus} 
			= \eos^{\brepvertex_i}(\intervalLoHi{u}, \hi{v}) 
			%= \eos^{\brepedge_{\iplus}}(u_{\brepedge_{\iplus}}, \intervalLoHi{v}),
			= 
			\begin{cases}
				\eos^{\brepedge_{\iplus}} \!\left( u_{\brepedge_{\iplus}}, \left[ \lo{v}, \frac{\lo{v} + \hi{v}}{2} \right] \right) &\text{ si } u_{\brepedge_{\iplus}} = \lo{u},\\
				\eos^{\brepedge_{\iplus}} \!\left( u_{\brepedge_{\iplus}}, \left[ \frac{\lo{v} + \hi{v}}{2}, \hi{v} \right] \right) &\text{ si } u_{\brepedge_{\iplus}} = \hi{u},
			\end{cases}
		\]
		dont les extrémités sont les points 
		$\v + \rho \unv_i = \eos^{\brepedge_{\iplus}}(u_{\brepedge_{\iplus}}, u_{\brepedge_{\iplus}})$ 
		et 
		$\v + \rho \vrm{m}_i = \eos^{\brepedge_{\iplus}}(u_{\brepedge_{\iplus}}, \frac{\lo{v} + \hi{v}}{2})$.
		
	\end{enumerate}
\end{enumerate}

\input{figures/code/pseudo_EdS_sommet/pseudo_EdS_sommet_quadpoly.tex}




avantages/inconvénients :
\begin{itemize}
	\item[$-$] valable seulement si la vitesse normale est uniforme
	\item[$-$] génère plusieurs carreaux
	%\item[$+$] les nouveaux carreaux sont rectangulaires ($\Rightarrow$ permet l'utilisation de quadratures simples (\cf \autoref{section:clenshaw_curtis_quadrature})
	\item[$+$] utiliser des carreaux paramétriques non restreints présente plusieurs avantages :
	\begin{enumerate}
		\item permet l'utilisation de quadratures simples (\cf \autoref{section:clenshaw_curtis_quadrature})
		\item simplifie les tests de sortie du domaine paramétrique (\cf partie optimisation de maillage trans-carreaux)
	\end{enumerate}
\end{itemize}


\subsubsection{Ajustement d'un seul carreau restreint}%Ajustement de carreau sphérique à un nuage de points}
\label{section:ajustement_carreau_spherique}
\def\s{\vit{s}}
On suppose maintenant que $\rho$ peut varier continument sur $\Sigma$. 

\begin{enumerate}
	\item on cherche alors à construire le carreau paramétrique restreint $\pseudoEdS{\brepvertex}{\rho} = (\uvdomain, \eos^{\brepvertex})$
	\begin{enumerate}
		\item on trouve une paramétrisation $\eos^{\brepvertex}$ d'un carreau $\Sigma_{\brepvertex} := \eos^{\brepvertex}(\intervalLoHi{u} \times \intervalLoHi{v})$ vérifiant $\pseudoEdS{\brepvertex}{\rho} \subset \Sigma_{\brepvertex}$
		\item on détermine les courbes de restriction du domaine paramétrique $\uvdomain \subset \intervalLoHi{u} \times \intervalLoHi{v}$ (\ie la trace des arcs caractéristiques limites dans l'espace paramétrique de $\Sigma_{\brepvertex}$)
	\end{enumerate}
	
	\item on cherche une paramétrisation de la forme
	\[
		\eos^{\brepvertex} = \v + \rho(\v) \mathbf{B} \vit{s},
	\]
	où
    \begin{enumerate}
        \item $\mathbf{B} = \colvec{\bb_1 & \bb_2 & \bb_3} \in \rotationgroup{3}$ désigne une matrice de rotation ($\transpose{\mathbf{B}} \mathbf{B} = \identitymatrix{}$ et $\determinant{\mathbf{B}} = 1$)% ($\dotprod{\br_i}{\br_j} = \delta_{i,j}$ et $\br_{i+2} = \crossprod{\br_i}{\br_{i+1}}$)
        \item $\vit{s} = 
		\begin{pmatrix}
            \cos \theta \cos \lambda \\
            \sin \theta \cos \lambda \\
            \sin \lambda \\
        \end{pmatrix}$
        \item $\theta(u,v) = \Theta u + \theta_0$ est la longitude
        \item $\lambda(u,v) = \Lambda v + \lambda_0$ est la latitude
        \item $\lo{u} = -1 \leq u \leq 1 = \hi{u}$
        \item $\lo{v} = -1 \leq v \leq 1 = \hi{v}$
    \end{enumerate}
    
    \item on veut éviter que $\Sigma_{\brepvertex}$ contienne les pôles $\lambda = \pm \frac{\pi}{2}$ (\ie $\vit{s} = \pm \bb_3$), car la paramétrisation $\eos^{\brepvertex}$ y est singulière (en effet $\eos^{\brepvertex}_{\theta}(\theta, \pm \frac{\pi}{2}) = \vit{0}$)
    \begin{enumerate}
        \item[$\to$] étendue en latitude $\Lambda$ (relativement) minimale
        %\item[$\to$] centrer $\lambda_0$ sur zéro
    \end{enumerate}
    \item on veut limiter le risque de ``fausses intersections'' avec les carreaux voisins lors de la construction de l'EdB
    \begin{enumerate}
        %\item[$\to$] aire de $\Sigma_{\brepvertex}$ (relativement) minimale ($\left| \Sigma_{\brepvertex} \right| = 4 \rho(\v)^2 \Theta \cos \lambda_0 \sin \Lambda$)
        \item[$\to$] ratio des aires $\frac{\left| \pseudoEdS{\brepvertex}{\rho} \right|}{\left| \Sigma_{\brepvertex} \right|}$ (relativement) proche de 1 ($\left| \Sigma_{\brepvertex} \right| = 4 \rho(\v)^2 \Theta \cos \lambda_0 \sin \Lambda$)
    \end{enumerate}
    
	\item 
	\begin{equation}
	    \vit{s} = \frac{1}{\rho(\v)} \transpose{\mathbf{B}} \left(\eos^{\brepvertex} - \v\right) 
	    = \begin{pmatrix}
	            \cos \theta \cos \lambda \\
	            \sin \theta \cos \lambda \\
	            \sin \lambda \\
	        \end{pmatrix},
	\end{equation}
	donc 
	\begin{align}
	    \theta &= \arctan \left( 
	        \frac{
	            \dotprod{\bb_2}{\left(\eos^{\brepvertex} - \v\right)}
	        }{
	            \dotprod{\bb_1}{\left(\eos^{\brepvertex} - \v\right)}
	        }
	    \right), \\
	    \lambda &= \arcsin \left( 
	        \frac{
	            \dotprod{\bb_3}{\left(\eos^{\brepvertex} - \v\right)}
	        }{
	            \rho(\v)
	        }
	    \right).
	\end{align} 
	
	 \item choix de $\mathbf{B}$ :
	 \item on note $\unv_i$ la direction normale à $\EdSpropreplus{\brepface_i}{\rho}$ au point $\eos^{\brepface_i}(u_{\brepface_i}, v_{\brepface_i})$
	 \item on choisit $\bb_1 = \unitized{\sum_{i=0}^{m-1} \unv_i}$
    \item on note $\p_i = \frac{\p}{\dotprod{\bb_1}{\unv_i}}$ la projection centrale de $\unv_i$ sur le plan tangent à la sphère unité au point $\bb_1$
    \item on détermine une base orthonormée $\left( \bb_2, \bb_3 \right)$ de ce plan, adéquate vis-à-vis des points $\family{\p}{i}{0}{m-1}$
    \begin{itemize}
    	\item rectangle englobant d'aire minimale
    	\item ellipse de covariance
    \end{itemize}
    \item[$\to$] on obtient la matrice $\mathbf{B} = \colvec{\bb_1 & \bb_2 & \bb_3}$
    \item on calcule les extrema en longitude et latitude atteints sur les arcs caractéristiques
    \begin{enumerate}
    	\item \cf notes ``Huygens'' \ldots
    \end{enumerate}
    \item on prend $\theta_0 = \frac{\lo{\theta} + \hi{\theta}}{2}$, $\lambda_0 = \frac{\lo{\lambda} + \hi{\lambda}}{2}$, $\Theta = (1 + \epsilon) \frac{\hi{\theta} - \lo{\theta}}{2}$ et $\Lambda = (1 + \epsilon) \frac{\hi{\lambda} - \lo{\lambda}}{2}$, où $\epsilon \geq 0$ est un paramètre de marge
    
    
    \item on ajoute au graphe des intersections tangentielles les courbes d'intersection suivantes :
    \begin{enumerate}
    	\item les carreaux $\pseudoEdS{\brepvertex}{\rho}$ et $\EdSpropreplus{\brepface_i}{\rho}$ s'intersectent au point $\eos^{\brepface_i}(u_{\brepface_i}, v_{\brepface_i})$ ;
    	
    	\item les carreaux $\pseudoEdS{\brepvertex}{\rho}$ et $\pseudoEdS{\brepedge_i}{\rho}$ s'intersectent le long de la courbe (arc caractéristique limite) $\eos^{\brepedge_i} (u_{\brepedge_i}, \intervalLoHi{v})$.
    	
    	\item Pour obtenir les coordonnées de ces points et courbes d'intersection dans l'espace paramétrique du carreau $\pseudoEdS{\brepvertex}{\rho}$,
    	\begin{itemize}
    		\item on en calcule les coordonnées sphériques
    		\begin{align}
			    \theta &= \arctan \left( 
			        \frac{
			            \dotprod{\bb_2}{\left(\bx - \v\right)}
			        }{
			            \dotprod{\bb_1}{\left(\bx - \v\right)}
			        }
			    \right), \\
			    \lambda &= \arcsin \left( 
			        \frac{
			            \dotprod{\bb_3}{\left(\bx - \v\right)}
			        }{
			            \rho(\v)
			        }
			    \right),
			\end{align} 
			\item on a alors
			\begin{align}
			    u &= \frac{\theta - \theta_0}{\Theta}, \\
			    v &= \frac{\lambda - \lambda_0}{\Lambda}.
			\end{align} 
    	\end{itemize}
    \end{enumerate}
    
\end{enumerate}











%\begin{enumerate}
%	\item on cherche alors à construire un seul carreau paramétrique restreint qui contient les arcs de cercles caractéristiques aux extrémités des arêtes \brep\ incidentes à $\brepvertex$
%	\item afin de simplifier la construction, on considère que $\v$ est situé à l'origine et que $\rho(\v) = 1$ (on appliquera la transformation adéquate en fin de construction pour se placer à nouveau dans le cas général)
%	\item le problème consiste alors, étant donné un ensemble $C$ de courbes sur la sphère unité $\mathbb{S}^2$, à construire un carreau paramétrique décrivant une région $\Sigma_S$ de $\mathbb{S}^2$ contenant $C$
%	\item on cherche également à faire en sorte $\Sigma_S$ englobe $S$ le plus étroitement possible ($\sim$ minimisation de l'aire) \textit{(développer motivation\ldots)}
%	
%	\item on choisit d'utiliser les coordonnées sphériques comme paramètres, \ie
%	\begin{equation}
%	    \bs = \mathbf{B} 
%	    \begin{pmatrix}
%		    \cos \theta \cos \lambda \\
%		    \sin \theta \cos \lambda \\
%		    \sin \lambda \\
%	    \end{pmatrix},
%	\end{equation}
%	où $\mathbf{B}$ désigne une matrice de rotation (\ie ses colonnes forment une base orthonormée de $\reals^3$) et $\theta$, $\lambda$ désignent respectivement la longitude et la latitude d'un point du carreau
%	\begin{align*}
%	    \theta(u,v)  &= \Theta u + \theta_0, \\
%	    \lambda(u,v) &= \Lambda v + \lambda_0,
%	\end{align*}
%	avec $-1 \leq u, v \leq 1$
%
%
%	\item on propose donc une méthode heuristique pour construire un tel carreau (\ie trouver $\mathbf{B}$, $\Theta$, $\theta_0$, $\Lambda$ et $\lambda_0$) d'aire minimale
%	\item on suppose qu'on dispose d'un échantillonnage suffisamment $S = \family{\s}{i}{1}{n}$ fin de l'ensemble des arcs de cercle caractéristiques limites
%	\item le problème consiste alors à construire un carreau paramétrique décrivant une région $\Sigma_S$ de $\mathbb{S}^2$ contenant $S$
%	
%	\item On note $\s_{0} = \sum_{i = 1}^n \s_i$. 
%	On suppose pour le moment que $\normtwo{\s_{0}} \neq 0$. 
%	On définit alors 
%	\begin{equation}
%	    \vrm{r}_1 = \unitized{ \s_{0} }.
%	\end{equation}
%\end{enumerate}	

%(\cf notes Huygens)
avantages/inconvénients :
\begin{itemize}
	\item[$-$] le nouveau carreau est restreint
	\item[$+$] valable également si la vitesse normale varie spatialement
	\item[$+$] génère un seul nouveau carreau de surface
\end{itemize}

\input{figures/code/pseudo_EdS_sommet/pseudo_EdS_sommet_trimmed_patch.tex}


%%Soit $\brepvertex$ un sommet \brep\ convexe dont le support géométrique est le point $\v \in \reals^3$. 
%%On cherche à construire un carreau paramétrique restreint décrivant $\pseudoEdS{\v}{\rho}$ \ie la région de la sphère $\sphere[\v][\rho(\v)]$ délimitée par les arcs de cercles caractéristiques aux extrémités des arêtes \brep\ incidentes à $\v$. 
%Afin de simplifier cette construction, on considère que $\v$ est situé à l'origine et que $\rho(\v) = 1$. 
%(On appliquera la transformation adéquate en fin de construction pour se placer à nouveau dans le cas général.)
%\par
%Le problème consiste alors, étant donné un ensemble de points $S = \family{\s}{i}{1}{n}$ sur la sphère unité $\mathbb{S}^2$, à construire un carreau paramétrique décrivant une portion $R$ de $\mathbb{S}^2$ contenant $S$. 
%On cherche également à minimiser l'aire de $R$ \ldots




\section{Construction d'un modèle \brep\ de l'EdB}

\begin{enumerate}
	\item les régions de l'EdS partielle qui sont exclues de l'EdB sont délimitées par les courbes d'intersections entre les carreaux restreints (argument à introduire plus tôt\ldots)\\
	\begin{proof}
		\cf notes ``Huygens'' ($\to$ définition implicite de l'EdB)
	\end{proof}
%	\item tous les points et courbes d'intersection tangentielle entre les carreaux de l'EdS partielle sont connus (\cf \autoref{section:construction_EdS_partielle})
%	\item (l'EdB ne peut contenir aucune courbe singulière convexe)
%	\item il reste à trouver les points et courbes d'intersection transverse (concave) entre les carreaux de l'EdS partielle
%	\item on complète ainsi le graphe des intersections, qui donne la topologie de l'agencement des carreaux (relations d'adjacences)
	\item pour obtenir un modèle \brep\ valide de l'EdB, il faut
	\begin{itemize}
		\item délimiter les faces, \ie éliminer les régions des carreaux qui sont exclues de l'EdB (\ie tout région $G$ pour laquelle il existe une région (\eg un carreau restreint) $H$ telle que $\forall \bx \in G, \implicitEdB{H}(\bx) < 0$) vérifiant les critères donnés dans la \autoref{section:def_brep_faces} :
		\begin{enumerate}
			\item délimitée par exactement un contour extérieur ($\to$ connexe, donc un carreau peut donner plusieurs faces) et éventuellement par un plusieurs contours intérieurs $\Rightarrow$ former contours et distinguer extérieur/intérieur
		\end{enumerate}
		
		\item matérialiser les courbes d'intersection par des arêtes vérifiant les critères donnés dans la \autoref{section:def_brep_edges} :
		\begin{enumerate}
			\item quasi-disjointes deux-à-deux $\Rightarrow$ scinder les courbes d'intersection en segments quasi-disjoints
			\item décomposer chaque arête en une paire de co-arêtes jumelles à chacune desquelles on associe 
			\begin{itemize}
				\item la face incidente
				\item le sommet origine
				\item la co-arête précédente (sur un contour)
				\item la co-arête suivante (sur un contour)
			\end{itemize}			 
		\end{enumerate}
		
		\item matérialiser les points d'intersection par des sommets vérifiant les critères donnés dans la \autoref{section:def_brep_vertices}
	\end{itemize}
\end{enumerate}

\subsection{Construction du graphe des intersections}
\begin{enumerate}
	\item tous les points et courbes d'intersection tangentielle entre les carreaux de l'EdS partielle sont connus (\cf \autoref{section:construction_EdS_partielle})
	\item (l'EdB ne peut contenir aucune courbe singulière convexe)
	\item il reste à trouver les points et courbes d'intersection transverse concave entre les carreaux de l'EdS partielle
	%\item on peut aisément orienter ces courbes de telle sorte que les régions à droite soient exclues de l'EdB (\cf notes ``Huygens'', paragraphe ``Intersection des EdS propres'')
	\item on complète ainsi le graphe des intersections, qui donne la topologie de l'agencement des carreaux (relations d'adjacences)
	\item (le choix de la méthode de calcul des intersections est étroitement lié au type de paramétrisation choisi pour les carreaux de surface $\Rightarrow$ détails d'implémentation donnés au chapitre \autoref{chap:methode_numerique})
	\item principe : 
	\begin{enumerate}
		\item calcul des intersections transverses entre paire de carreaux \textit{non-restreints}
		\item segmentation des courbes d'intersection en segments quasi-disjoints (intersection de 3 carreaux \textit{non-restreints} ou plus)
		\item \guillemets{clipping} par le domaine paramétrique de chaque carreau \textit{restreint}
	\end{enumerate}
\end{enumerate}

\par\bigskip

\begin{enumerate}
	\item Pour un carreau donné, on peut extraire le sous-graphe 
	\begin{itemize}
		\item dont les arcs sont des segments (quasi-disjoints) de courbes d'intersection entre ce carreau et chaque autre carreau adjacent
		\item dont les n\oe uds sont les extrémités de ces segments (points d'intersection entre plusieurs courbes)
	\end{itemize}
	\item on peut orienter ces segments de telle sorte que les régions localement à droite de chacun d'eux soient nécessairement exclues de l'EdB
	\begin{enumerate}
		\item ambigu pour les intersections tangentielles, mais celles-ci décrivent nécessairement des portions du bord du domaine paramétrique et sont déjà orientées de façon adéquate
		\item les nouvelles intersections calculées ne peuvent pas correspondre à des courbes singulières convexes de l'EdB, donc l'orientation correcte de ces courbes est obtenue aisément (\cf notes ``Huygens'', paragraphe ``Intersection des EdS propres'')
	\end{enumerate}
	\item on obtient donc un graphe planaire orienté dont un plongement dans $\reals^2$ est donné par la trace des courbes d'intersections dans l'espace paramétrique du carreau (exemple donné sur la \autoref{fig:sous_graphe_intersections_brut}).
\end{enumerate}
%pour un carreau donné, le sous-graphe constitué par les points et segments d'intersection entre ce carreau et tous les autres est un graphe planaire orienté dont un plongement dans $\reals^2$ est donné par la trace des courbes d'intersections dans son espace paramétrique (exemple donné sur la \autoref{fig:sous_graphe_intersections_brut}).

\begin{figure}
	\centering
	\plotCurvedDirectedGraph{../../FFTsurf/test/graph/graph_bezier_control_points.dat}{25mm}
	\caption{Plongement du sous-graphe des intersections associé à un carreau de surface.}
	\label{fig:sous_graphe_intersections_brut}
\end{figure}


\subsection{Construction des faces, arêtes et sommets \brep}
pour chaque carreau : extraction des cycles du graphe d'intersection, caractérisations des contours (extérieurs/intérieurs), détermination des faces $\to$ insertion des contours dans la \brep\ $\to$ insertion des (co-)arêtes et sommets
\begin{figure}
	\centering
	\input{algorithmes/make_cycles.tex}
	\caption{Organigramme de l'algorithme d'extraction des cycles d'un graphe orienté plongé dans $\reals^2$.}
\end{figure}


\begin{figure}
	\centering
	\input{figures/code/graph/graph_faces}
	\caption{Faces du graphe}
\end{figure}