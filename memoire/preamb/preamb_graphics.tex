\usepackage{graphicx}

% Conversion pt -> mm
%https://tex.stackexchange.com/questions/8260/what-are-the-various-units-ex-em-in-pt-bp-dd-pc-expressed-in-mm
%(The syntax is \convertto{mm}{1pt} to convert 1pt in mm)
\makeatletter
\def\convertto#1#2{\strip@pt\dimexpr #2*65536/\number\dimexpr 1#1}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\makeatletter
%\def\ratiolengths{}
%\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{pythontex}

\usepackage{pgf, pgfplots, pgfplotstable}
\usepgfplotslibrary{external, colormaps, patchplots, groupplots}%, clickable}
\usepackage{datatool}
%https://axiomatic.neophilus.net/using-datatool-and-tikz-to-generate-figures-from-data/

%\usepackage{auto-pst-pdf}
\usepackage{pst-solides3d,pstricks-add}
%\usepackage[locale=DE]{siunitx}

\pgfplotsset{compat=newest}

\usepackage{tikz, tikzscale}
\usetikzlibrary{math, fit, calc, external, fadings, angles, arrows, arrows.meta, positioning, angles, quotes, patterns, backgrounds, shapes, shapes.geometric, shapes.misc, decorations.markings}


%\tikzexternalize[prefix=figures/pgf/]

\usepackage{transparent}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usetikzlibrary{pgfplots.colorbrewer}

\definecolor{s1}{HTML}{68ABD9}
\definecolor{s2}{HTML}{FA7566}%FA6655}%{FAA43A}%
\definecolor{s3}{HTML}{98D45B}%AADA57}%{60BD68}%
\definecolor{s4}{HTML}{897EDA}
\definecolor{s5}{HTML}{FAA43A}%{FA6655}%
\definecolor{s6}{HTML}{46AA5B}%60BD68}%{AADA57}%
\definecolor{s7}{HTML}{F094C3}
\definecolor{s8}{HTML}{A3A3A3}
\definecolor{s9}{HTML}{000000}

\pgfplotscreateplotcyclelist{set1}{
  	s1, mark=square*,   mark size=1.2pt\\
	s2, mark=*,         mark size=1.5pt\\
	s3, mark=triangle*, mark size=1.7pt\\
	s4, mark=diamond*,  mark size=1.7pt\\
	s5, mark=square*,   mark size=1.2pt\\
	s6, mark=*,         mark size=1.5pt\\
	s7, mark=triangle*, mark size=1.7pt\\
	s8, mark=diamond*,  mark size=1.5pt\\
	s9, mark=square*,   mark size=1.2pt\\
}


\pgfplotscreateplotcyclelist{setBW}{
  	every mark/.append style={solid,fill=white}, mark=square*, mark size=1.2pt\\
	every mark/.append style={solid,fill=white}, mark=*, mark size=1.5pt\\
	every mark/.append style={solid,fill=white}, mark=triangle*, mark size=1.7pt\\
	every mark/.append style={solid,fill=white}, mark=diamond*, mark size=1.7pt\\
%	black, mark=square*,   mark size=1.2pt\\
%	black, mark=*,         mark size=1.5pt\\
%	black, mark=triangle*, mark size=1.7pt\\
%	black, mark=diamond*,  mark size=1.5pt\\
%	black, mark=square*,   mark size=1.2pt\\
}


\pgfmathsetlengthmacro\MajorTickLength{
	\pgfkeysvalueof{/pgfplots/major tick length} * 0.75
}
\pgfmathsetlengthmacro\MinorTickLength{
	\MajorTickLength * 0.5
}

\pgfplotsset{
    /pgfplots/layers/Bowpark/.define layer set={
        axis background,axis grid,main,axis ticks,axis lines,axis tick labels,
        axis descriptions,axis foreground
    }{/pgfplots/layers/standard},
    /pgfplots/layers/mylayerset/.define layer set={
        axis background,axis grid,axis ticks,axis lines,main,axis tick labels,
        axis descriptions,axis foreground
    }{/pgfplots/layers/standard},
}


\pgfplotsset{
    ylabel right/.style={
        after end axis/.append code={
            \node [rotate=90, anchor=north] at (rel axis cs:1,0.5) {#1};
        }   
    },
    ylabelv right/.style={
        after end axis/.append code={
            \node [rotate=0, anchor=west] at (rel axis cs:1,0.5) {#1};
        }   
    }
}

\pgfplotsset{
	clip marker paths=true,%
	axis on top=false,%true,%
	set layers=Bowpark,%
	cycle multiindex* list={
		set1
		\nextlist
		thick
		\nextlist
		mark options={scale=.85}%
	},%
	clip mode=individual,%
	axis line style={line width=0.5pt},%
	grid style={line width=0.3pt, draw=black!13},%
	major grid style={line width=0.4pt,draw=black!25},%
	every tick/.style={
        black,
        line width=0.5pt
      },%
    major tick length=\MajorTickLength,%
    minor tick length=\MinorTickLength,%
	legend cell align={left},%
	legend style={line width=0.5pt}%
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% l√©gendes
\newcommand{\legenddash}[1]{%
	\raisebox{2pt}{\tikz{\draw[#1,solid,thick](0,0) -- (4mm,0);}}%
}

\def\lgdsqrsiz{1.442pt}
\newcommand{\legendsquare}[1]{\raisebox{1.2pt}{\tikz{\fill[#1] (-\lgdsqrsiz , -\lgdsqrsiz) rectangle (\lgdsqrsiz , \lgdsqrsiz);}}}

\newcommand{\legenddot}[1]{\raisebox{0.93pt}{\tikz{\fill[#1] (0.0mm,0.0mm) circle [radius=1.7pt];}}}

\newcommand{\legendtriangle}[1]{\raisebox{1.5pt}{\tikz{\fill[#1] (0.0pt,2.2pt) -- (-1.9pt,-1.1pt) -- (1.9pt,-1.1pt);}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\makeatletter
\newcommand{\gettikzxy}[3]{%
  \tikz@scan@one@point\pgfutil@firstofone#1\relax
  \edef#2{\the\pgf@x}%
  \edef#3{\the\pgf@y}%
}

\newcommand{\globalgettikzxy}[3]{%
  \tikz@scan@one@point\pgfutil@firstofone#1\relax
  \edef\@tempdima{\the\pgf@x}%
  \edef\@tempdimb{\the\pgf@y}%
  \global#2=\@tempdima%
  \global#3=\@tempdimb%
}

\newcommand\getwidthofnode[2]{%
    \pgfextractx{\pgf@xb}{\pgfpointanchor{#2}{east}}%
    \pgfextractx{\pgf@xa}{\pgfpointanchor{#2}{west}}% 
    \pgfmathsetlength{\pgf@xb}{\pgf@xb - \pgf@xa}%
	\global#1=\pgf@xb%
}

\newcommand\getheightofnode[2]{%
    \pgfextracty{\pgf@yb}{\pgfpointanchor{#2}{north}}%
    \pgfextracty{\pgf@ya}{\pgfpointanchor{#2}{south}}% 
    \pgfmathsetlength{\pgf@yb}{\pgf@yb - \pgf@ya}%
	\global#1=\pgf@yb%
}
\makeatother


% get row/column index in groupplot
\makeatletter
\newcommand{\currentrow}{\the\pgfplots@group@current@row}
\newcommand{\currentcolumn}{\the\pgfplots@group@current@column}
\newcommand{\totalplots}{\pgfplots@group@totalplots}
\makeatother



%https://tex.stackexchange.com/questions/141181/inverting-a-colormap-in-pgfplots
\makeatletter
\def\invertcolormap#1{%
    \pgfplotsarraycopy{pgfpl@cm@#1}\to{custom@COPY}%
    \c@pgf@counta=0
    \c@pgf@countb=\pgfplotsarraysizeof{custom@COPY}\relax
    \c@pgf@countd=\c@pgf@countb
    \advance\c@pgf@countd by-1 %
    \pgfutil@loop
    \ifnum\c@pgf@counta<\c@pgf@countb
        \pgfplotsarrayselect{\c@pgf@counta}\of{custom@COPY}\to\pgfplots@loc@TMPa
        \pgfplotsarrayletentry\c@pgf@countd\of{pgfpl@cm@#1}=\pgfplots@loc@TMPa
        \advance\c@pgf@counta by1 %
        \advance\c@pgf@countd by-1 %
    \pgfutil@repeat
%\pgfplots@colormap@showdebuginfofor{#1}%
}%
\makeatother





% chemin(s) des figures
\graphicspath{{./figures/}}%,{../fig2/}}


% controle des objets flottants (figures, tables)
\renewcommand{\topfraction}{0.7}     % autorise 70% page de graphique en haut
\renewcommand{\bottomfraction}{0.5}  % autorise 50% page de graphique en bas
\renewcommand{\floatpagefraction}{0.7}
\renewcommand{\textfraction}{0.1}


%\tikz@scan@one@point\pgfutil@firstofone#1\relax
%\edef#2{\the\pgf@x}%
%\edef#3{\the\pgf@y}%


\newcommand\circlearcparameters[6]{%
% INPUTS:
%    #1: start coordinate, 
%    #2: end coordinate, 
%    #3: angle spanned by the arc (in degrees),
% OUTPUTS:
%    #4: start angle,
%    #5: end angle,
%    #6: arc radius.
\gettikzxy{#1}{\axco}{\ayco}
\gettikzxy{#2}{\bxco}{\byco}
\pgfmathsetmacro\mxco{0.5*(\axco + \bxco)}%
\pgfmathsetmacro\myco{0.5*(\ayco + \byco)}%
\pgfmathsetmacro\abxco{\bxco-\axco}%
\pgfmathsetmacro\abyco{\byco-\ayco}%
\pgfmathsetmacro\lenab{veclen(\abxco,\abyco)}
\pgfmathsetmacro\sinhalfangle{sin(0.5*#3)}
\pgfmathsetmacro#6{0.5*\lenab/\sinhalfangle}
\pgfmathsetmacro\mangle{-atan2(\abxco,\abyco)}
\pgfmathsetmacro#4{\mangle - 0.5*#3}
\pgfmathsetmacro#5{\mangle + 0.5*#3}
%\draw[#4] #1 arc (\aangle:{\aangle + #3}:\arcradius) #5;
%\node[red] at #1 {\convertto{mm}{\abxco},\abyco};%{\aangle, \lenab, \sinhalfangle, \arcradius};
}
