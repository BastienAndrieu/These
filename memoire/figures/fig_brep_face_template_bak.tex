\newcommand{\helpergrid}[1]{
	\pgfmathsetmacro\gridstep{1.0/\ngrid}%
	\draw[step=\gridstep,dotted,red,thin] (0,0) grid (1,1);
	\foreach \j in {0,...,#1}{
		\foreach \x in {0,1}{
			\node[gridtick] at (\x,{\j/10.}) {$\j$};
		}
	}
	\foreach \i in {1,...,#1}{
		\foreach \y in {0,1}{
			\node[gridtick] at ({\i/10.},\y) {$\i$};
		}
	}
}





\newcommand{\figbrepface}[4]{%#1 : indice de face, #2 taille figure, #3 x ancrage, #4 y ancrage
\def\alp{0.35}%{0.2}
\DTLsetseparator{,}%
\DTLloaddb[noheader,keys={i,x,y,a}]{verts}{figures/data/fig_brep_faces/verts_#1.dat}%
%
\DTLloaddb[noheader,keys={r,g,b}]{fclr}{figures/data/fig_brep_faces/facecolor_#1.dat}%
\DTLassign{fclr}{1}{\rfai=r,\gfai=g,\bfai=b}% 
\definecolor{facecolor}{RGB}{\rfai,\gfai,\bfai}
%
\DTLloaddb[noheader,keys={um,vm,dum,dvm,ied,ihe,iw}]{cuvdat}{figures/data/fig_brep_faces/curve_uvdata_#1.dat}%
\DTLassign{cuvdat}{\DTLrowcount{cuvdat}}{\um=um, \vm=vm, \dum=dum, \dvm=dvm, \ied=ied, \ihe=ihe, \nw=iw}%
\pgfmathsetmacro\inw{int(round(\nw))}%
%
\def\ngrid{10}
\def\edglabsep{0.15}
%
\begin{tikzpicture}[%
	x = #2, y = #2,
	gridtick/.style={red, fill=white, font=\tiny, inner sep=0.5pt},
	img/.style={anchor=south west, inner sep=0},
	label/.style={inner sep=1pt, font=\scriptsize},
	]
	{\transparent{0.08}%
		\node[img] (surface) at (0,0) {\includegraphics[width=#2]{figures/fig_brep_faces/surface_#1}};
	}%
	\node[img] (face) at (0,0) {\includegraphics[width=#2]{figures/fig_brep_faces/face_#1}};
	{\transparent{0.07}%
		\node[img] (surface) at (0,0) {\includegraphics[width=#2]{figures/fig_brep_faces/surface_#1}};}
	\DTLforeach*{verts}{\i=i, \x=x, \y=y, \a=a}%
	{%
		\pgfmathsetmacro\alpi{1 + (1 - \a)*(\alp - 1)}%
		{\transparent{\alpi}%
			\fill[black] (\x,\y) circle (1pt);
			\node[label, anchor=south west] at (\x,\y) {$\mathrm{V}_{\mkern-2mu\i}$};%
		}%
	}%
	%
	\node[img] (face) at (0,0) {\includegraphics[width=#2]{figures/fig_brep_faces/edges_vis_#1}};
	{\transparent{\alp}%
		\node[img] (face) at (0,0) {\includegraphics[width=#2]{figures/fig_brep_faces/edges_hid_#1}};
	}%
	%\helpergrid{\ngrid}
	% UV-SPACE ##################
	\def\ngriduv{6}
	\node[anchor=north, inner sep=0] (uvspace) at ([yshift=-4mm]surface.south)
	{%
		\begin{tikzpicture}[
			uvgrid/.style={black!10!white},
			curv/.style={line width=0.6pt, line cap=round},
			]
			\begin{axis}[width=#2, height=#2, xmin=-1, xmax=1, ymin=-1, ymax=1,
				hide axis]
				\pgfplotsinvokeforeach{0,...,\ngriduv}
				{%
					\draw[uvgrid] (axis cs:-1,{-1 + 2*##1/\ngriduv}) -- ++ (axis direction cs:2,0);
					\draw[uvgrid] (axis cs:{-1 + 2*##1/\ngriduv},-1) -- ++ (axis direction cs:0,2);
				}
%				\fill[facecolor, even odd rule] plot file {figures/data/fig_brep_faces/contour_ext_#1.dat}
%				\pgfplotsinvokeforeach{1,...,\inw}{%
%					\fill[facecolor, even odd rule] plot file {figures/data/fig_brep_faces/contour_int_#1_##1.dat} ;
%				};
				\ifnum \inw > 0
					\fill[facecolor] 
					plot file {figures/data/fig_brep_faces/contour_ext_#1.dat}
					plot file {figures/data/fig_brep_faces/contour_int_#1_1.dat};
				\else
					\fill[facecolor] plot file {figures/data/fig_brep_faces/contour_ext_#1.dat};
				\fi
				%
				\pgfplotsinvokeforeach{1,2,...,\DTLrowcount{cuvdat}}{%
					\draw[curv, 
						-{Triangle[left]}, 
						shorten <= 0.25pt, 
						shorten >= 0.25pt] plot file 	{figures/data/fig_brep_faces/curve_uv_#1_##1.dat};
				}%
				\DTLforeach*{cuvdat}{\um=um, \vm=vm, \dum=dum, \dvm=dvm, \ied=ied, \ihe=ihe, \iw=iw}{%
					\pgfmathsetmacro\iied{int(round(\ied))}%
					\pgfmathsetmacro\iihe{int(round(\ihe))}%
					\begingroup\edef\temp{\endgroup\noexpand\node[label, anchor=center] at (axis cs:{\um + \edglabsep*\dvm},{\vm - \edglabsep*\dum}) {$E_{\iied}^{\iihe}$};}\temp
				}%
			\end{axis}		
		\end{tikzpicture}
	};
\end{tikzpicture}
\DTLgdeletedb{cuvdat}
\DTLgdeletedb{fclr}
\DTLgdeletedb{verts}
}